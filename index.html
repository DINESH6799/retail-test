<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retail Brands Scraper for Expansion</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Backend API URL - change this to your deployed backend URL
        const API_URL = 'https://retail-test-b54d.onrender.com';

        // Category-based filtering rules
        const CATEGORY_FILTERS = {
            'Apparel': ['clothing_store', 'shoe_store', 'department_store', 'shopping_mall', 'store'],
            'F&B': ['restaurant', 'cafe', 'meal_takeaway', 'bakery', 'food', 'meal_delivery', 'bar'],
            'Electronics': ['electronics_store', 'store', 'home_goods_store'],
            'Grocery': ['supermarket', 'grocery_or_supermarket', 'store', 'convenience_store'],
            'Pharmacy': ['pharmacy', 'drugstore', 'health', 'store'],
            'Cinema': ['movie_theater', 'movie_rental'],
            'Realty': ['real_estate_agency', 'point_of_interest'],
            'Salons': ['hair_care', 'beauty_salon', 'spa'],
            'Mobile Stores': ['electronics_store', 'store'],
            'Opticals': ['health', 'store']
        };

        // Invalid location name patterns to remove
        const INVALID_PATTERNS = [
            // Roads and streets
            /\b(road|street|highway|lane|avenue|marg|path)\b/i,
            // Residential
            /\b(apartment|complex|residence|society|villa|tower|flat)\b/i,
            // Areas and zones
            /\b(area|zone|sector|block|phase)\b/i,
            // Non-retail locations
            /\b(hospital|clinic|school|college|university|atm|bank|post office)\b/i,
            // Generic/vague
            /^(near|opp|opposite|next to|behind)\b/i,
            // Just numbers or coordinates
            /^[\d\s,.-]+$/
        ];

        // Indian cities with their boundaries for grid-based scraping
        const INDIAN_CITIES = {
    "Agra": {
        center: [27.1767, 78.0081],
        bounds: { min_lat: 27.06, max_lat: 27.3, min_lng: 77.86, max_lng: 78.16 }
    },
    "Ahmedabad": {
        center: [23.0225, 72.5714],
        bounds: { min_lat: 22.77, max_lat: 23.27, min_lng: 72.22, max_lng: 72.92 }
    },
    "Ajmer": {
        center: [26.4499, 74.6399],
        bounds: { min_lat: 26.4, max_lat: 26.5, min_lng: 74.58, max_lng: 74.7 }
    },
    "Akola": {
        center: [20.7002, 77.0082],
        bounds: { min_lat: 20.65, max_lat: 20.75, min_lng: 76.95, max_lng: 77.07 }
    },
    "Aligarh": {
        center: [27.8974, 78.0880],
        bounds: { min_lat: 27.85, max_lat: 27.95, min_lng: 78.03, max_lng: 78.15 }
    },
    "Allahabad": {
        center: [25.4358, 81.8463],
        bounds: { min_lat: 25.32, max_lat: 25.56, min_lng: 81.7, max_lng: 82.0 }
    },
    "Alwar": {
        center: [27.5530, 76.6346],
        bounds: { min_lat: 27.5, max_lat: 27.6, min_lng: 76.57, max_lng: 76.69 }
    },
    "Ambala": {
        center: [30.3782, 76.7767],
        bounds: { min_lat: 30.33, max_lat: 30.43, min_lng: 76.72, max_lng: 76.84 }
    },
    "Amravati": {
        center: [20.9320, 77.7523],
        bounds: { min_lat: 20.88, max_lat: 20.98, min_lng: 77.69, max_lng: 77.81 }
    },
    "Amritsar": {
        center: [31.6340, 74.8723],
        bounds: { min_lat: 31.58, max_lat: 31.68, min_lng: 74.81, max_lng: 74.93 }
    },
    "Anand": {
        center: [22.5645, 72.9289],
        bounds: { min_lat: 22.51, max_lat: 22.61, min_lng: 72.87, max_lng: 72.99 }
    },
    "Asansol": {
        center: [23.6739, 86.9524],
        bounds: { min_lat: 23.62, max_lat: 23.72, min_lng: 86.89, max_lng: 87.01 }
    },
    "Aurangabad": {
        center: [19.8762, 75.3433],
        bounds: { min_lat: 19.76, max_lat: 20.0, min_lng: 75.19, max_lng: 75.49 }
    },
    "Bahadurgarh": {
        center: [28.6928, 76.9278],
        bounds: { min_lat: 28.64, max_lat: 28.74, min_lng: 76.87, max_lng: 76.99 }
    },
    "Bardhaman": {
        center: [23.2324, 87.8615],
        bounds: { min_lat: 23.18, max_lat: 23.28, min_lng: 87.8, max_lng: 87.92 }
    },
    "Bareilly": {
        center: [28.3670, 79.4304],
        bounds: { min_lat: 28.32, max_lat: 28.42, min_lng: 79.37, max_lng: 79.49 }
    },
    "Bathinda": {
        center: [30.2110, 74.9455],
        bounds: { min_lat: 30.16, max_lat: 30.26, min_lng: 74.89, max_lng: 75.01 }
    },
    "Begusarai": {
        center: [25.4182, 86.1336],
        bounds: { min_lat: 25.37, max_lat: 25.47, min_lng: 86.07, max_lng: 86.19 }
    },
    "Belgaum": {
        center: [15.8497, 74.4977],
        bounds: { min_lat: 15.8, max_lat: 15.9, min_lng: 74.44, max_lng: 74.56 }
    },
    "Bengaluru": {
        center: [12.9716, 77.5946],
        bounds: { min_lat: 12.72, max_lat: 13.22, min_lng: 77.24, max_lng: 77.94 }
    },
    "Bhavnagar": {
        center: [21.7645, 72.1519],
        bounds: { min_lat: 21.71, max_lat: 21.81, min_lng: 72.09, max_lng: 72.21 }
    },
    "Bhiwadi": {
        center: [28.2124, 76.8604],
        bounds: { min_lat: 28.16, max_lat: 28.26, min_lng: 76.8, max_lng: 76.92 }
    },
    "Bhopal": {
        center: [23.2599, 77.4126],
        bounds: { min_lat: 23.14, max_lat: 23.38, min_lng: 77.26, max_lng: 77.56 }
    },
    "Bhubaneswar": {
        center: [20.2961, 85.8245],
        bounds: { min_lat: 20.18, max_lat: 20.42, min_lng: 85.67, max_lng: 85.97 }
    },
    "Bikaner": {
        center: [28.0229, 73.3119],
        bounds: { min_lat: 27.97, max_lat: 28.07, min_lng: 73.25, max_lng: 73.37 }
    },
    "Bulandshahr": {
        center: [28.4073, 77.8498],
        bounds: { min_lat: 28.36, max_lat: 28.46, min_lng: 77.79, max_lng: 77.91 }
    },
    "Chandigarh": {
        center: [30.7333, 76.7794],
        bounds: { min_lat: 30.68, max_lat: 30.78, min_lng: 76.72, max_lng: 76.84 }
    },
    "Chennai": {
        center: [13.0827, 80.2707],
        bounds: { min_lat: 12.83, max_lat: 13.33, min_lng: 79.92, max_lng: 80.62 }
    },
    "Coimbatore": {
        center: [11.0168, 76.9558],
        bounds: { min_lat: 10.9, max_lat: 11.14, min_lng: 76.81, max_lng: 77.11 }
    },
    "Cuttack": {
        center: [20.4625, 85.8830],
        bounds: { min_lat: 20.41, max_lat: 20.51, min_lng: 85.82, max_lng: 85.94 }
    },
    "Dehradun": {
        center: [30.3165, 78.0322],
        bounds: { min_lat: 30.2, max_lat: 30.44, min_lng: 77.88, max_lng: 78.18 }
    },
    "Delhi NCR": {
        center: [28.6139, 77.2090],
        bounds: { min_lat: 28.36, max_lat: 28.86, min_lng: 76.86, max_lng: 77.56 }
    },
    "Deoghar": {
        center: [24.4850, 86.6983],
        bounds: { min_lat: 24.43, max_lat: 24.54, min_lng: 86.64, max_lng: 86.76 }
    },
    "Dhanbad": {
        center: [23.7957, 86.4304],
        bounds: { min_lat: 23.75, max_lat: 23.85, min_lng: 86.37, max_lng: 86.49 }
    },
    "Dharwad": {
        center: [15.4589, 75.0078],
        bounds: { min_lat: 15.41, max_lat: 15.51, min_lng: 74.95, max_lng: 75.07 }
    },
    "Durg Bhilai": {
        center: [21.1904, 81.2849],
        bounds: { min_lat: 21.14, max_lat: 21.24, min_lng: 81.22, max_lng: 81.34 }
    },
    "Erode": {
        center: [11.3410, 77.7172],
        bounds: { min_lat: 11.29, max_lat: 11.39, min_lng: 77.66, max_lng: 77.78 }
    },
    "Gandhidham": {
        center: [23.0753, 70.1334],
        bounds: { min_lat: 23.03, max_lat: 23.13, min_lng: 70.07, max_lng: 70.19 }
    },
    "Gaya": {
        center: [24.7955, 84.9994],
        bounds: { min_lat: 24.75, max_lat: 24.85, min_lng: 84.94, max_lng: 85.06 }
    },
    "Goa": {
        center: [15.2993, 74.1240],
        bounds: { min_lat: 15.25, max_lat: 15.35, min_lng: 74.06, max_lng: 74.18 }
    },
    "Gorakhpur": {
        center: [26.7606, 83.3732],
        bounds: { min_lat: 26.71, max_lat: 26.81, min_lng: 83.31, max_lng: 83.43 }
    },
    "Guntur": {
        center: [16.3067, 80.4365],
        bounds: { min_lat: 16.19, max_lat: 16.43, min_lng: 80.29, max_lng: 80.59 }
    },
    "Guwahati": {
        center: [26.1445, 91.7362],
        bounds: { min_lat: 26.02, max_lat: 26.26, min_lng: 91.59, max_lng: 91.89 }
    },
    "Gwalior": {
        center: [26.2183, 78.1828],
        bounds: { min_lat: 26.1, max_lat: 26.34, min_lng: 78.03, max_lng: 78.33 }
    },
    "Haldwani": {
        center: [29.2183, 79.5130],
        bounds: { min_lat: 29.17, max_lat: 29.27, min_lng: 79.45, max_lng: 79.57 }
    },
    "Hapur": {
        center: [28.7296, 77.7756],
        bounds: { min_lat: 28.68, max_lat: 28.78, min_lng: 77.72, max_lng: 77.84 }
    },
    "Haridwar": {
        center: [29.9457, 78.1642],
        bounds: { min_lat: 29.9, max_lat: 30.0, min_lng: 78.1, max_lng: 78.22 }
    },
    "Hosur": {
        center: [12.7409, 77.8253],
        bounds: { min_lat: 12.69, max_lat: 12.79, min_lng: 77.77, max_lng: 77.89 }
    },
    "Hyderabad": {
        center: [17.3850, 78.4867],
        bounds: { min_lat: 17.14, max_lat: 17.64, min_lng: 78.14, max_lng: 78.84 }
    },
    "Indore": {
        center: [22.7196, 75.8577],
        bounds: { min_lat: 22.6, max_lat: 22.84, min_lng: 75.71, max_lng: 76.01 }
    },
    "Jabalpur": {
        center: [23.1815, 79.9864],
        bounds: { min_lat: 23.06, max_lat: 23.3, min_lng: 79.84, max_lng: 80.14 }
    },
    "Jaipur": {
        center: [26.9124, 75.7873],
        bounds: { min_lat: 26.79, max_lat: 27.03, min_lng: 75.64, max_lng: 75.94 }
    },
    "Jalandhar": {
        center: [31.3260, 75.5762],
        bounds: { min_lat: 31.28, max_lat: 31.38, min_lng: 75.52, max_lng: 75.64 }
    },
    "Jalgaon": {
        center: [21.0077, 75.5626],
        bounds: { min_lat: 20.96, max_lat: 21.06, min_lng: 75.5, max_lng: 75.62 }
    },
    "Jammu": {
        center: [32.7266, 74.8570],
        bounds: { min_lat: 32.61, max_lat: 32.85, min_lng: 74.71, max_lng: 75.01 }
    },
    "Jamnagar": {
        center: [22.4707, 70.0577],
        bounds: { min_lat: 22.42, max_lat: 22.52, min_lng: 70.0, max_lng: 70.12 }
    },
    "Jamshedpur": {
        center: [22.8046, 86.2029],
        bounds: { min_lat: 22.68, max_lat: 22.92, min_lng: 86.05, max_lng: 86.35 }
    },
    "Jodhpur": {
        center: [26.2389, 73.0243],
        bounds: { min_lat: 26.12, max_lat: 26.36, min_lng: 72.87, max_lng: 73.17 }
    },
    "Kakinada": {
        center: [16.9891, 82.2475],
        bounds: { min_lat: 16.94, max_lat: 17.04, min_lng: 82.19, max_lng: 82.31 }
    },
    "Kanchipuram": {
        center: [12.8342, 79.7036],
        bounds: { min_lat: 12.78, max_lat: 12.88, min_lng: 79.64, max_lng: 79.76 }
    },
    "Kanpur": {
        center: [26.4499, 80.3319],
        bounds: { min_lat: 26.33, max_lat: 26.57, min_lng: 80.18, max_lng: 80.48 }
    },
    "Karnal": {
        center: [29.6857, 76.9905],
        bounds: { min_lat: 29.64, max_lat: 29.74, min_lng: 76.93, max_lng: 77.05 }
    },
    "Khanna": {
        center: [30.7054, 76.2228],
        bounds: { min_lat: 30.66, max_lat: 30.76, min_lng: 76.16, max_lng: 76.28 }
    },
    "Kharagpur": {
        center: [22.3460, 87.2319],
        bounds: { min_lat: 22.3, max_lat: 22.4, min_lng: 87.17, max_lng: 87.29 }
    },
    "Kochi": {
        center: [9.9312, 76.2673],
        bounds: { min_lat: 9.81, max_lat: 10.05, min_lng: 76.12, max_lng: 76.42 }
    },
    "Kolhapur": {
        center: [16.7050, 74.2433],
        bounds: { min_lat: 16.65, max_lat: 16.75, min_lng: 74.18, max_lng: 74.3 }
    },
    "Kolkata": {
        center: [22.5726, 88.3639],
        bounds: { min_lat: 22.32, max_lat: 22.82, min_lng: 88.01, max_lng: 88.71 }
    },
    "Kollam": {
        center: [8.8932, 76.6141],
        bounds: { min_lat: 8.84, max_lat: 8.94, min_lng: 76.55, max_lng: 76.67 }
    },
    "Kota": {
        center: [25.2138, 75.8648],
        bounds: { min_lat: 25.16, max_lat: 25.26, min_lng: 75.8, max_lng: 75.92 }
    },
    "Kottayam": {
        center: [9.5916, 76.5222],
        bounds: { min_lat: 9.54, max_lat: 9.64, min_lng: 76.46, max_lng: 76.58 }
    },
    "Kozhikode": {
        center: [11.2588, 75.7804],
        bounds: { min_lat: 11.14, max_lat: 11.38, min_lng: 75.63, max_lng: 75.93 }
    },
    "Kumbakonam": {
        center: [10.9601, 79.3845],
        bounds: { min_lat: 10.91, max_lat: 11.01, min_lng: 79.32, max_lng: 79.44 }
    },
    "Kurnool": {
        center: [15.8281, 78.0373],
        bounds: { min_lat: 15.78, max_lat: 15.88, min_lng: 77.98, max_lng: 78.1 }
    },
    "Lucknow": {
        center: [26.8467, 80.9462],
        bounds: { min_lat: 26.73, max_lat: 26.97, min_lng: 80.8, max_lng: 81.1 }
    },
    "Ludhiana": {
        center: [30.9010, 75.8573],
        bounds: { min_lat: 30.78, max_lat: 31.02, min_lng: 75.71, max_lng: 76.01 }
    },
    "Madurai": {
        center: [9.9252, 78.1198],
        bounds: { min_lat: 9.81, max_lat: 10.05, min_lng: 77.97, max_lng: 78.27 }
    },
    "Mangalore": {
        center: [12.9141, 74.8560],
        bounds: { min_lat: 12.79, max_lat: 13.03, min_lng: 74.71, max_lng: 75.01 }
    },
    "Mathura": {
        center: [27.4924, 77.6737],
        bounds: { min_lat: 27.44, max_lat: 27.54, min_lng: 77.61, max_lng: 77.73 }
    },
    "Meerut": {
        center: [28.9845, 77.7064],
        bounds: { min_lat: 28.86, max_lat: 29.1, min_lng: 77.56, max_lng: 77.86 }
    },
    "Mehsana": {
        center: [23.5880, 72.3693],
        bounds: { min_lat: 23.54, max_lat: 23.64, min_lng: 72.31, max_lng: 72.43 }
    },
    "Modinagar": {
        center: [28.8307, 77.5857],
        bounds: { min_lat: 28.78, max_lat: 28.88, min_lng: 77.53, max_lng: 77.65 }
    },
    "Moradabad": {
        center: [28.8389, 78.7378],
        bounds: { min_lat: 28.79, max_lat: 28.89, min_lng: 78.68, max_lng: 78.8 }
    },
    "Mumbai": {
        center: [19.0760, 72.8777],
        bounds: { min_lat: 18.83, max_lat: 19.33, min_lng: 72.53, max_lng: 73.23 }
    },
    "Muzaffarpur": {
        center: [26.1225, 85.3906],
        bounds: { min_lat: 26.07, max_lat: 26.17, min_lng: 85.33, max_lng: 85.45 }
    },
    "Mysore": {
        center: [12.2958, 76.6394],
        bounds: { min_lat: 12.18, max_lat: 12.42, min_lng: 76.49, max_lng: 76.79 }
    },
    "Nagercoil": {
        center: [8.1779, 77.4340],
        bounds: { min_lat: 8.13, max_lat: 8.23, min_lng: 77.37, max_lng: 77.49 }
    },
    "Nagpur": {
        center: [21.1458, 79.0882],
        bounds: { min_lat: 21.03, max_lat: 21.27, min_lng: 78.94, max_lng: 79.24 }
    },
    "Nanded": {
        center: [19.1383, 77.3210],
        bounds: { min_lat: 19.09, max_lat: 19.19, min_lng: 77.26, max_lng: 77.38 }
    },
    "Nashik": {
        center: [19.9975, 73.7898],
        bounds: { min_lat: 19.88, max_lat: 20.12, min_lng: 73.64, max_lng: 73.94 }
    },
    "Nellore": {
        center: [14.4426, 79.9865],
        bounds: { min_lat: 14.39, max_lat: 14.49, min_lng: 79.93, max_lng: 80.05 }
    },
    "Palakkad": {
        center: [10.7867, 76.6548],
        bounds: { min_lat: 10.74, max_lat: 10.84, min_lng: 76.59, max_lng: 76.71 }
    },
    "Panipat": {
        center: [29.3909, 76.9635],
        bounds: { min_lat: 29.34, max_lat: 29.44, min_lng: 76.9, max_lng: 77.02 }
    },
    "Patiala": {
        center: [30.3398, 76.3869],
        bounds: { min_lat: 30.29, max_lat: 30.39, min_lng: 76.33, max_lng: 76.45 }
    },
    "Patna": {
        center: [25.5941, 85.1376],
        bounds: { min_lat: 25.47, max_lat: 25.71, min_lng: 84.99, max_lng: 85.29 }
    },
    "Puducherry": {
        center: [11.9416, 79.8083],
        bounds: { min_lat: 11.89, max_lat: 11.99, min_lng: 79.75, max_lng: 79.87 }
    },
    "Pune": {
        center: [18.5204, 73.8567],
        bounds: { min_lat: 18.27, max_lat: 18.77, min_lng: 73.51, max_lng: 74.21 }
    },
    "Raipur": {
        center: [21.2514, 81.6296],
        bounds: { min_lat: 21.13, max_lat: 21.37, min_lng: 81.48, max_lng: 81.78 }
    },
    "Rajahmundry": {
        center: [17.0005, 81.8040],
        bounds: { min_lat: 16.95, max_lat: 17.05, min_lng: 81.74, max_lng: 81.86 }
    },
    "Rajkot": {
        center: [22.3039, 70.8022],
        bounds: { min_lat: 22.18, max_lat: 22.42, min_lng: 70.65, max_lng: 70.95 }
    },
    "Ranchi": {
        center: [23.3441, 85.3096],
        bounds: { min_lat: 23.22, max_lat: 23.46, min_lng: 85.16, max_lng: 85.46 }
    },
    "Rohtak": {
        center: [28.8955, 76.5890],
        bounds: { min_lat: 28.85, max_lat: 28.95, min_lng: 76.53, max_lng: 76.65 }
    },
    "Rourkela": {
        center: [22.2604, 84.8536],
        bounds: { min_lat: 22.21, max_lat: 22.31, min_lng: 84.79, max_lng: 84.91 }
    },
    "Saharanpur": {
        center: [29.9640, 77.5460],
        bounds: { min_lat: 29.91, max_lat: 30.01, min_lng: 77.49, max_lng: 77.61 }
    },
    "Salem": {
        center: [11.6643, 78.1460],
        bounds: { min_lat: 11.54, max_lat: 11.78, min_lng: 78.0, max_lng: 78.3 }
    },
    "Sangli": {
        center: [16.8524, 74.5815],
        bounds: { min_lat: 16.8, max_lat: 16.9, min_lng: 74.52, max_lng: 74.64 }
    },
    "Satna": {
        center: [24.6005, 80.8322],
        bounds: { min_lat: 24.55, max_lat: 24.65, min_lng: 80.77, max_lng: 80.89 }
    },
    "Siliguri": {
        center: [26.7271, 88.3953],
        bounds: { min_lat: 26.68, max_lat: 26.78, min_lng: 88.34, max_lng: 88.46 }
    },
    "Sivakasi": {
        center: [9.4532, 77.7954],
        bounds: { min_lat: 9.4, max_lat: 9.5, min_lng: 77.74, max_lng: 77.86 }
    },
    "Solapur": {
        center: [17.6599, 75.9064],
        bounds: { min_lat: 17.61, max_lat: 17.71, min_lng: 75.85, max_lng: 75.97 }
    },
    "Sonipat": {
        center: [28.9931, 77.0151],
        bounds: { min_lat: 28.94, max_lat: 29.04, min_lng: 76.96, max_lng: 77.08 }
    },
    "Srinagar": {
        center: [34.0837, 74.7973],
        bounds: { min_lat: 33.96, max_lat: 34.2, min_lng: 74.65, max_lng: 74.95 }
    },
    "Surat": {
        center: [21.1702, 72.8311],
        bounds: { min_lat: 21.05, max_lat: 21.29, min_lng: 72.68, max_lng: 72.98 }
    },
    "Tanjore": {
        center: [10.7870, 79.1378],
        bounds: { min_lat: 10.74, max_lat: 10.84, min_lng: 79.08, max_lng: 79.2 }
    },
    "Thane": {
        center: [19.2183, 72.9781],
        bounds: { min_lat: 19.1, max_lat: 19.34, min_lng: 72.83, max_lng: 73.13 }
    },
    "Thiruvalla": {
        center: [9.3831, 76.5742],
        bounds: { min_lat: 9.33, max_lat: 9.43, min_lng: 76.51, max_lng: 76.63 }
    },
    "Thiruvananthapuram": {
        center: [8.5241, 76.9366],
        bounds: { min_lat: 8.4, max_lat: 8.64, min_lng: 76.79, max_lng: 77.09 }
    },
    "Thoothukudi": {
        center: [8.7642, 78.1348],
        bounds: { min_lat: 8.71, max_lat: 8.81, min_lng: 78.07, max_lng: 78.19 }
    },
    "Thrissur": {
        center: [10.5276, 76.2144],
        bounds: { min_lat: 10.48, max_lat: 10.58, min_lng: 76.15, max_lng: 76.27 }
    },
    "Tirunelveli": {
        center: [8.7139, 77.7567],
        bounds: { min_lat: 8.66, max_lat: 8.76, min_lng: 77.7, max_lng: 77.82 }
    },
    "Tirupati": {
        center: [13.6288, 79.4192],
        bounds: { min_lat: 13.58, max_lat: 13.68, min_lng: 79.36, max_lng: 79.48 }
    },
    "Tiruppur": {
        center: [11.1085, 77.3411],
        bounds: { min_lat: 11.06, max_lat: 11.16, min_lng: 77.28, max_lng: 77.4 }
    },
    "Trichy": {
        center: [10.7905, 78.7047],
        bounds: { min_lat: 10.67, max_lat: 10.91, min_lng: 78.55, max_lng: 78.85 }
    },
    "Udaipur": {
        center: [24.5854, 73.7125],
        bounds: { min_lat: 24.54, max_lat: 24.64, min_lng: 73.65, max_lng: 73.77 }
    },
    "Vadodara": {
        center: [22.3072, 73.1812],
        bounds: { min_lat: 22.19, max_lat: 22.43, min_lng: 73.03, max_lng: 73.33 }
    },
    "Vapi": {
        center: [20.3717, 72.9045],
        bounds: { min_lat: 20.32, max_lat: 20.42, min_lng: 72.84, max_lng: 72.96 }
    },
    "Varanasi": {
        center: [25.3176, 82.9739],
        bounds: { min_lat: 25.2, max_lat: 25.44, min_lng: 82.82, max_lng: 83.12 }
    },
    "Vellore": {
        center: [12.9165, 79.1325],
        bounds: { min_lat: 12.87, max_lat: 12.97, min_lng: 79.07, max_lng: 79.19 }
    },
    "Vijayawada": {
        center: [16.5062, 80.6480],
        bounds: { min_lat: 16.39, max_lat: 16.63, min_lng: 80.5, max_lng: 80.8 }
    },
    "Visakhapatnam": {
        center: [17.6868, 83.2185],
        bounds: { min_lat: 17.57, max_lat: 17.81, min_lng: 83.07, max_lng: 83.37 }
    },
    "Warangal": {
        center: [17.9784, 79.6005],
        bounds: { min_lat: 17.93, max_lat: 18.03, min_lng: 79.54, max_lng: 79.66 }
    },
    "Yamuna Nagar": {
        center: [30.1290, 77.2674],
        bounds: { min_lat: 30.08, max_lat: 30.18, min_lng: 77.21, max_lng: 77.33 }
    },
};

        function App() {
            const [step, setStep] = useState(1);
            const [brandsFile, setBrandsFile] = useState(null);
            const [brands, setBrands] = useState([]);
            const [selectedCity, setSelectedCity] = useState('');
            const [citySearch, setCitySearch] = useState('');
            const [apiKey, setApiKey] = useState('');
            const [isValidating, setIsValidating] = useState(false);
            const [validationError, setValidationError] = useState('');
            const [isScraping, setIsScraping] = useState(false);
            const [progress, setProgress] = useState({ current: 0, total: 0, message: '' });
            const [results, setResults] = useState([]);
            const [estimatedCost, setEstimatedCost] = useState(0);
            const [actualCost, setActualCost] = useState(0);
            const [sessionId, setSessionId] = useState(null);
            const [pollingInterval, setPollingInterval] = useState(null);

            const fileInputRef = useRef(null);

            // Session Recovery - Check on page load
            useEffect(() => {
                const savedSessionId = localStorage.getItem('lastSessionId');
                
                if (savedSessionId) {
                    console.log('ðŸ”„ Found saved session:', savedSessionId);
                    
                    fetch(`${API_URL}/api/status/${savedSessionId}`)
                        .then(res => res.json())
                        .then(data => {
                            console.log('Session status:', data.status);
                            
                            if (data.status === 'complete') {
                                console.log('âœ… Previous session complete!');
                                setSessionId(savedSessionId);
                                loadResults(savedSessionId);
                            } else if (data.status === 'in_progress') {
                                console.log('ðŸ”„ Resuming session...');
                                setSessionId(savedSessionId);
                                setStep(5);
                                setIsScraping(true);
                                startPolling(savedSessionId);
                            } else if (data.status === 'failed') {
                                localStorage.removeItem('lastSessionId');
                                localStorage.removeItem('sessionStartTime');
                            }
                        })
                        .catch(err => {
                            console.error('Error checking session:', err);
                            localStorage.removeItem('lastSessionId');
                            localStorage.removeItem('sessionStartTime');
                        });
                }
            }, []);

            // Load results from completed session
            const loadResults = async (sessionId) => {
                try {
                    const response = await fetch(`${API_URL}/api/results/${sessionId}`);
                    const data = await response.json();
                    
                    if (data.results && data.results.length > 0) {
                        setResults(data.results);
                        setActualCost(data.totalCost || 0);
                        setProgress({
                            current: data.results.length,
                            total: data.results.length,
                            message: `Complete! Found ${data.results.length} locations.`,
                            percentage: 100
                        });
                        setStep(6);
                        localStorage.removeItem('lastSessionId');
                        localStorage.removeItem('sessionStartTime');
                    }
                } catch (error) {
                    console.error('Error loading results:', error);
                    alert('Failed to load results.');
                }
            };

            // Start polling for status
            const startPolling = (sessionId) => {
                console.log('ðŸ”„ Starting polling:', sessionId);
                
                const interval = setInterval(async () => {
                    try {
                        const response = await fetch(`${API_URL}/api/status/${sessionId}`);
                        const data = await response.json();
                        
                        setProgress({
                            current: data.progress.current,
                            total: data.progress.total,
                            message: `Searching for ${data.progress.currentBrand || 'brands'}...`,
                            percentage: data.progress.percentage,
                            currentBrand: data.progress.currentBrand,
                            brandIndex: data.progress.brandIndex,
                            totalBrands: brands.length
                        });
                        
                        setActualCost(data.cost || 0);
                        
                        if (data.status === 'complete') {
                            console.log('âœ… Complete!');
                            clearInterval(interval);
                            setPollingInterval(null);
                            await loadResults(sessionId);
                        } else if (data.status === 'failed') {
                            clearInterval(interval);
                            setPollingInterval(null);
                            alert('Scraping failed.');
                            setStep(4);
                            setIsScraping(false);
                        }
                    } catch (error) {
                        console.error('Poll error:', error);
                    }
                }, 10000);
                
                setPollingInterval(interval);
            };

            // Cleanup polling
            useEffect(() => {
                return () => {
                    if (pollingInterval) clearInterval(pollingInterval);
                };
            }, [pollingInterval]);


            // Cleaning function - strict brand name matching
            const isStrictBrandMatch = (locationName, brandName) => {
                if (!locationName || !brandName) return false;
                
                const name = locationName.toLowerCase().trim();
                const brand = brandName.toLowerCase().trim();
                
                // Exact match or brand at start of name
                if (name === brand || name.startsWith(brand + ' ')) return true;
                
                // Brand with common suffixes
                const validSuffixes = ['store', 'outlet', 'shop', 'showroom', 'retail', 'factory'];
                for (const suffix of validSuffixes) {
                    if (name === `${brand} ${suffix}` || name === `${brand}-${suffix}`) {
                        return true;
                    }
                }
                
                // Check if brand is a complete word in the name (not part of another word)
                const words = name.split(/\s+/);
                return words.includes(brand);
            };

            // Check if location name contains invalid patterns
            const hasInvalidPattern = (name) => {
                if (!name) return true;
                return INVALID_PATTERNS.some(pattern => pattern.test(name));
            };

            // Check if category is valid for brand category
            const isValidCategory = (gmapsCategory, brandCategory) => {
                if (!gmapsCategory || !brandCategory) return false;
                
                const allowedCategories = CATEGORY_FILTERS[brandCategory] || [];
                return allowedCategories.some(cat => 
                    gmapsCategory.toLowerCase().includes(cat.toLowerCase())
                );
            };

            // Main cleaning function
            const cleanResults = (rawResults) => {
                return rawResults.filter(result => {
                    // 1. Must have required data
                    if (!result.name || !result.address || !result.latitude || !result.longitude) {
                        return false;
                    }

                    // 2. Must be operational
                    if (result.business_status !== 'OPERATIONAL') {
                        return false;
                    }

                    // 3. Strict brand name matching
                    if (!isStrictBrandMatch(result.name, result.search_brand)) {
                        return false;
                    }

                    // 4. No invalid patterns in name
                    if (hasInvalidPattern(result.name)) {
                        return false;
                    }

                    // 5. Valid category for brand type
                    if (!isValidCategory(result.gmaps_category, result.search_category)) {
                        return false;
                    }

                    return true;
                });
            };

            // Get cleaning stats
            const getCleaningStats = (raw, clean) => {
                return {
                    total: raw.length,
                    cleaned: clean.length,
                    removed: raw.length - clean.length,
                    removedByReason: {
                        missingData: raw.filter(r => !r.name || !r.address || !r.latitude || !r.longitude).length,
                        notOperational: raw.filter(r => r.business_status !== 'OPERATIONAL').length,
                        brandMismatch: raw.filter(r => !isStrictBrandMatch(r.name, r.search_brand)).length,
                        invalidPattern: raw.filter(r => hasInvalidPattern(r.name)).length,
                        wrongCategory: raw.filter(r => !isValidCategory(r.gmaps_category, r.search_category)).length
                    }
                };
            };

            const filteredCities = Object.keys(INDIAN_CITIES).filter(city =>
                city.toLowerCase().includes(citySearch.toLowerCase())
            );

            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (event) => {
                    const text = event.target.result;
                    const lines = text.split('\n').filter(line => line.trim());
                    const headers = lines[0].split(',').map(h => h.trim());
                    
                    const parsedBrands = lines.slice(1).map(line => {
                        const values = line.split(',').map(v => v.trim());
                        return {
                            brand: values[0] || '',
                            sku: values[1] || '',
                            category: values[2] || ''
                        };
                    }).filter(b => b.brand);

                    setBrands(parsedBrands);
                    setBrandsFile(file);
                };
                reader.readAsText(file);
            };

            const calculateEstimatedCost = () => {
                if (!selectedCity || brands.length === 0) return;

                const cityData = INDIAN_CITIES[selectedCity];
                const bounds = cityData.bounds;
                
                // Calculate grid points
                const gridSpacing = 20; // km - FASTEST scraping (3-4 hours)
                const latDegPerKm = 1 / 110.574;
                const lngDegPerKm = 1 / (111.320 * Math.cos(cityData.center[0] * Math.PI / 180));
                
                const latStep = gridSpacing * latDegPerKm;
                const lngStep = gridSpacing * lngDegPerKm;
                
                const latPoints = Math.ceil((bounds.max_lat - bounds.min_lat) / latStep) + 1;
                const lngPoints = Math.ceil((bounds.max_lng - bounds.min_lng) / lngStep) + 1;
                const totalGridPoints = latPoints * lngPoints;
                
                // Estimate API calls
                const estimatedCalls = brands.length * totalGridPoints;
                // Places API Nearby Search: â‚¹17 per 1000 calls
                const costPerCall = 17 / 1000;
                const estimated = estimatedCalls * costPerCall;
                
                setEstimatedCost(estimated);
            };

            useEffect(() => {
                if (selectedCity && brands.length > 0) {
                    calculateEstimatedCost();
                }
            }, [selectedCity, brands]);

            const validateApiKey = async () => {
                setIsValidating(true);
                setValidationError('');

                console.log('ðŸ” Validating API key...');
                console.log('ðŸ”— Backend URL:', API_URL);

                try {
                    const response = await fetch(`${API_URL}/api/validate-key`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ apiKey })
                    });

                    console.log('ðŸ“¡ Response status:', response.status);
                    
                    if (!response.ok) {
                        throw new Error(`Server responded with status: ${response.status}`);
                    }

                    const data = await response.json();
                    console.log('âœ… Validation response:', data);

                    if (!data.valid) {
                        setValidationError(data.error);
                        setIsValidating(false);
                        return false;
                    }

                    setIsValidating(false);
                    return true;
                } catch (error) {
                    console.error('âŒ Validation error:', error);
                    setValidationError(`Failed to connect to server: ${error.message}. The backend may be starting up (wait 30-60 seconds) or check your connection.`);
                    setIsValidating(false);
                    return false;
                }
            };

            const generateGrid = (bounds, spacingKm, centerLat) => {
                const latDegPerKm = 1 / 110.574;
                const lngDegPerKm = 1 / (111.320 * Math.cos(centerLat * Math.PI / 180));
                
                const latStep = spacingKm * latDegPerKm;
                const lngStep = spacingKm * lngDegPerKm;
                
                const grid = [];
                let lat = bounds.min_lat;
                while (lat <= bounds.max_lat) {
                    let lng = bounds.min_lng;
                    while (lng <= bounds.max_lng) {
                        grid.push({ lat, lng });
                        lng += lngStep;
                    }
                    lat += latStep;
                }
                return grid;
            };

            const fetchPlaces = async (lat, lng, keyword, radius = 5000) => {
                const places = [];
                let nextPageToken = null;
                let apiCalls = 0;

                do {
                    const params = new URLSearchParams({
                        key: apiKey,
                        location: `${lat},${lng}`,
                        radius: radius,
                        keyword: keyword
                    });

                    if (nextPageToken) {
                        params.append('pagetoken', nextPageToken);
                    }

                    const url = `https://maps.googleapis.com/maps/api/place/nearbysearch/json?${params}`;
                    
                    try {
                        const response = await fetch(url);
                        const data = await response.json();
                        apiCalls++;

                        if (data.status === 'OK' || data.status === 'ZERO_RESULTS') {
                            places.push(...(data.results || []));
                            nextPageToken = data.next_page_token || null;
                            
                            if (nextPageToken) {
                                await new Promise(resolve => setTimeout(resolve, 2000));
                            }
                        } else if (data.status === 'OVER_QUERY_LIMIT') {
                            throw new Error('API quota exceeded. Stopping scrape.');
                        } else {
                            nextPageToken = null;
                        }
                    } catch (error) {
                        console.error('Error fetching places:', error);
                        throw error;
                    }
                } while (nextPageToken);

                return { places, apiCalls };
            };

            const deduplicatePlaces = (places) => {
                const seen = new Set();
                return places.filter(place => {
                    const placeId = place.place_id;
                    if (placeId && !seen.has(placeId)) {
                        seen.add(placeId);
                        return true;
                    }
                    return false;
                });
            };

            const startScraping = async () => {
                console.log('ðŸš€ Starting scraping (polling mode)...');
                
                const isValid = await validateApiKey();
                if (!isValid) {
                    alert('Invalid API key. Please check and try again.');
                    return;
                }

                if (estimatedCost > 20000) {
                    alert(`Estimated cost (â‚¹${estimatedCost.toFixed(2)}) exceeds â‚¹20,000 limit.`);
                    return;
                }

                setIsScraping(true);
                setStep(5);
                setProgress({ current: 0, total: 0, message: 'Starting...', percentage: 0 });
                
                const newSessionId = Date.now().toString();
                setSessionId(newSessionId);
                
                localStorage.setItem('lastSessionId', newSessionId);
                localStorage.setItem('sessionStartTime', new Date().toISOString());

                try {
                    const cityData = INDIAN_CITIES[selectedCity];
                    
                    const response = await fetch(`${API_URL}/api/scrape`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            brands: brands,
                            cityBounds: cityData.bounds,
                            cityCenter: cityData.center,
                            apiKey: apiKey,
                            sessionId: newSessionId
                        })
                    });

                    const data = await response.json();
                    
                    if (data.success) {
                        console.log('âœ… Started in background!');
                        startPolling(newSessionId);
                    } else {
                        throw new Error(data.error || 'Failed to start scraping');
                    }

                } catch (error) {
                    console.error('Error:', error);
                    alert(`Failed to start: ${error.message}`);
                    setIsScraping(false);
                    setStep(4);
                    localStorage.removeItem('lastSessionId');
                    localStorage.removeItem('sessionStartTime');
                }
            };

            const downloadResults = async (useClean = false) => {
                // Don't use state (limited to 1000)! Fetch fresh from backend
                try {
                    console.log('ðŸ“¥ Fetching ALL results for download...');
                    
                    const response = await fetch(`${API_URL}/api/results/${sessionId}`);
                    const data = await response.json();
                    
                    if (!data.results || data.results.length === 0) {
                        alert('No results found. Please try again.');
                        return;
                    }
                    
                    console.log(`âœ… Fetched ${data.results.length} results for download`);
                    
                    const dataToDownload = useClean ? cleanResults(data.results) : data.results;
                    
                    const headers = ['brand', 'sku', 'category', 'gmaps_category', 'name', 'address', 'latitude', 'longitude', 'business_status', 'gmaps_url', 'is_brand_match'];
                    const csvContent = [
                        headers.join(','),
                        ...dataToDownload.map(row => [
                            row.search_brand,
                            row.search_sku,
                            row.search_category,
                            row.gmaps_category,
                            `"${(row.name || '').replace(/"/g, '""')}"`,
                            `"${(row.address || '').replace(/"/g, '""')}"`,
                            row.latitude,
                            row.longitude,
                            row.business_status,
                            row.gmaps_url,
                            row.is_brand_match
                        ].join(','))
                    ].join('\n');

                    const blob = new Blob([csvContent], { type: 'text/csv' });
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    const suffix = useClean ? '_CLEAN' : '_RAW';
                    a.download = `${selectedCity.replace(/\s+/g, '_')}_brand_results${suffix}_${new Date().toISOString().split('T')[0]}.csv`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                    
                    console.log(`âœ… Downloaded ${dataToDownload.length} rows`);
                } catch (error) {
                    console.error('Download error:', error);
                    alert('Failed to download results. Please try again.');
                }
            };

            const resetApp = () => {
                setStep(1);
                setBrandsFile(null);
                setBrands([]);
                setSelectedCity('');
                setCitySearch('');
                setApiKey('');
                setValidationError('');
                setResults([]);
                setEstimatedCost(0);
                setActualCost(0);
                setProgress({ current: 0, total: 0, message: '' });
                if (fileInputRef.current) {
                    fileInputRef.current.value = '';
                }
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-8 px-4">
                    <div className="max-w-4xl mx-auto">
                        {/* Header */}
                        <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                            <h1 className="text-3xl font-bold text-gray-800 text-center mb-2">
                                <i className="fas fa-store mr-3 text-indigo-600"></i>
                                Retail Brands Scraper for Expansion
                            </h1>
                            <p className="text-center text-gray-600">
                                Discover brand locations across Indian cities using Google Maps API
                            </p>
                        </div>

                        {/* Progress Steps */}
                        <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                            <div className="flex items-center justify-between">
                                {[
                                    { num: 1, label: 'Upload Brands', icon: 'fa-upload' },
                                    { num: 2, label: 'Select City', icon: 'fa-map-marker-alt' },
                                    { num: 3, label: 'API Key', icon: 'fa-key' },
                                    { num: 4, label: 'Review', icon: 'fa-check-circle' },
                                    { num: 5, label: 'Scraping', icon: 'fa-spinner' },
                                    { num: 6, label: 'Download', icon: 'fa-download' }
                                ].map((s, idx) => (
                                    <div key={s.num} className="flex items-center">
                                        <div className={`flex flex-col items-center ${step >= s.num ? 'text-indigo-600' : 'text-gray-400'}`}>
                                            <div className={`w-10 h-10 rounded-full flex items-center justify-center ${step >= s.num ? 'bg-indigo-600 text-white' : 'bg-gray-300 text-gray-600'}`}>
                                                <i className={`fas ${s.icon}`}></i>
                                            </div>
                                            <span className="text-xs mt-1 hidden sm:block">{s.label}</span>
                                        </div>
                                        {idx < 5 && (
                                            <div className={`w-8 h-1 mx-2 ${step > s.num ? 'bg-indigo-600' : 'bg-gray-300'}`}></div>
                                        )}
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Main Content */}
                        <div className="bg-white rounded-lg shadow-lg p-8">
                            {/* Step 1: Upload Brands */}
                            {step === 1 && (
                                <div className="space-y-6">
                                    <h2 className="text-2xl font-semibold text-gray-800 mb-4">
                                        Step 1: Upload Brands CSV
                                    </h2>
                                    <p className="text-gray-600 mb-4">
                                        Upload a CSV file with columns: <code className="bg-gray-100 px-2 py-1 rounded">brand</code>, <code className="bg-gray-100 px-2 py-1 rounded">sku</code>, <code className="bg-gray-100 px-2 py-1 rounded">category</code>
                                    </p>
                                    
                                    <div className="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-indigo-500 transition-colors">
                                        <input
                                            ref={fileInputRef}
                                            type="file"
                                            accept=".csv"
                                            onChange={handleFileUpload}
                                            className="hidden"
                                            id="file-upload"
                                        />
                                        <label htmlFor="file-upload" className="cursor-pointer">
                                            <i className="fas fa-cloud-upload-alt text-5xl text-gray-400 mb-4"></i>
                                            <p className="text-lg text-gray-600">Click to upload or drag and drop</p>
                                            <p className="text-sm text-gray-400 mt-2">CSV files only</p>
                                        </label>
                                    </div>

                                    {brandsFile && (
                                        <div className="bg-green-50 border border-green-200 rounded-lg p-4">
                                            <p className="text-green-800 font-medium">
                                                <i className="fas fa-check-circle mr-2"></i>
                                                {brandsFile.name} uploaded successfully
                                            </p>
                                            <p className="text-green-600 text-sm mt-1">
                                                {brands.length} brands loaded
                                            </p>
                                        </div>
                                    )}

                                    {brands.length > 0 && (
                                        <div className="flex justify-end">
                                            <button
                                                onClick={() => setStep(2)}
                                                className="bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition-colors"
                                            >
                                                Next: Select City <i className="fas fa-arrow-right ml-2"></i>
                                            </button>
                                        </div>
                                    )}
                                </div>
                            )}

                            {/* Step 2: Select City */}
                            {step === 2 && (
                                <div className="space-y-6">
                                    <h2 className="text-2xl font-semibold text-gray-800 mb-4">
                                        Step 2: Select City
                                    </h2>
                                    <p className="text-gray-600 mb-4">
                                        Choose the Indian city where you want to scrape brand locations
                                    </p>

                                    <div className="relative">
                                        <input
                                            type="text"
                                            placeholder="Search for a city..."
                                            value={citySearch}
                                            onChange={(e) => setCitySearch(e.target.value)}
                                            className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                        />
                                        <i className="fas fa-search absolute right-4 top-4 text-gray-400"></i>
                                    </div>

                                    <div className="grid grid-cols-2 md:grid-cols-3 gap-3 max-h-96 overflow-y-auto">
                                        {filteredCities.map(city => (
                                            <button
                                                key={city}
                                                onClick={() => setSelectedCity(city)}
                                                className={`p-4 rounded-lg border-2 transition-all ${
                                                    selectedCity === city
                                                        ? 'border-indigo-600 bg-indigo-50 text-indigo-700'
                                                        : 'border-gray-200 hover:border-indigo-300'
                                                }`}
                                            >
                                                <i className="fas fa-map-marker-alt mr-2"></i>
                                                {city}
                                            </button>
                                        ))}
                                    </div>

                                    {selectedCity && (
                                        <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                            <p className="text-blue-800 font-medium">
                                                <i className="fas fa-info-circle mr-2"></i>
                                                Selected: {selectedCity}
                                            </p>
                                        </div>
                                    )}

                                    <div className="flex justify-between">
                                        <button
                                            onClick={() => setStep(1)}
                                            className="bg-gray-200 text-gray-700 px-6 py-3 rounded-lg hover:bg-gray-300 transition-colors"
                                        >
                                            <i className="fas fa-arrow-left mr-2"></i> Back
                                        </button>
                                        {selectedCity && (
                                            <button
                                                onClick={() => setStep(3)}
                                                className="bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition-colors"
                                            >
                                                Next: API Key <i className="fas fa-arrow-right ml-2"></i>
                                            </button>
                                        )}
                                    </div>
                                </div>
                            )}

                            {/* Step 3: API Key */}
                            {step === 3 && (
                                <div className="space-y-6">
                                    <h2 className="text-2xl font-semibold text-gray-800 mb-4">
                                        Step 3: Enter Google Maps API Key
                                    </h2>
                                    <p className="text-gray-600 mb-4">
                                        Enter your Google Maps API key. Make sure the Places API is enabled.
                                    </p>

                                    <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4">
                                        <p className="text-yellow-800 text-sm">
                                            <i className="fas fa-exclamation-triangle mr-2"></i>
                                            <strong>Required APIs:</strong> Places API (Nearby Search)
                                        </p>
                                    </div>

                                    <input
                                        type="password"
                                        placeholder="Enter your API key"
                                        value={apiKey}
                                        onChange={(e) => setApiKey(e.target.value)}
                                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                    />

                                    {validationError && (
                                        <div className="bg-red-50 border border-red-200 rounded-lg p-4">
                                            <p className="text-red-800 text-sm">
                                                <i className="fas fa-exclamation-circle mr-2"></i>
                                                {validationError}
                                            </p>
                                        </div>
                                    )}

                                    <div className="flex justify-between">
                                        <button
                                            onClick={() => setStep(2)}
                                            className="bg-gray-200 text-gray-700 px-6 py-3 rounded-lg hover:bg-gray-300 transition-colors"
                                        >
                                            <i className="fas fa-arrow-left mr-2"></i> Back
                                        </button>
                                        {apiKey && (
                                            <button
                                                onClick={() => setStep(4)}
                                                className="bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition-colors"
                                            >
                                                Next: Review <i className="fas fa-arrow-right ml-2"></i>
                                            </button>
                                        )}
                                    </div>
                                </div>
                            )}

                            {/* Step 4: Review */}
                            {step === 4 && (
                                <div className="space-y-6">
                                    <h2 className="text-2xl font-semibold text-gray-800 mb-4">
                                        Step 4: Review & Start Scraping
                                    </h2>

                                    <div className="bg-gray-50 rounded-lg p-6 space-y-4">
                                        <div className="flex justify-between border-b pb-3">
                                            <span className="text-gray-600">Brands to scrape:</span>
                                            <span className="font-semibold">{brands.length}</span>
                                        </div>
                                        <div className="flex justify-between border-b pb-3">
                                            <span className="text-gray-600">City:</span>
                                            <span className="font-semibold">{selectedCity}</span>
                                        </div>
                                        <div className="flex justify-between border-b pb-3">
                                            <span className="text-gray-600">Estimated Cost:</span>
                                            <span className="font-semibold text-indigo-600">â‚¹{estimatedCost.toFixed(2)}</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className="text-gray-600">Cost Limit:</span>
                                            <span className="font-semibold">â‚¹20,000</span>
                                        </div>
                                    </div>

                                    {estimatedCost > 20000 && (
                                        <div className="bg-red-50 border border-red-200 rounded-lg p-4">
                                            <p className="text-red-800 font-medium">
                                                <i className="fas fa-exclamation-circle mr-2"></i>
                                                Warning: Estimated cost exceeds the â‚¹20,000 limit!
                                            </p>
                                            <p className="text-red-600 text-sm mt-1">
                                                Please reduce the number of brands or select a smaller city.
                                            </p>
                                        </div>
                                    )}

                                    <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                        <p className="text-blue-800 text-sm">
                                            <i className="fas fa-info-circle mr-2"></i>
                                            The scraping will automatically stop if the cost reaches â‚¹20,000.
                                        </p>
                                    </div>

                                    <div className="flex justify-between">
                                        <button
                                            onClick={() => setStep(3)}
                                            className="bg-gray-200 text-gray-700 px-6 py-3 rounded-lg hover:bg-gray-300 transition-colors"
                                        >
                                            <i className="fas fa-arrow-left mr-2"></i> Back
                                        </button>
                                        <button
                                            onClick={startScraping}
                                            disabled={isValidating || isScraping}
                                            className="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed"
                                        >
                                            {isValidating ? (
                                                <>
                                                    <i className="fas fa-spinner fa-spin mr-2"></i> Validating...
                                                </>
                                            ) : (
                                                <>
                                                    <i className="fas fa-play mr-2"></i> Start Scraping
                                                </>
                                            )}
                                        </button>
                                    </div>
                                </div>
                            )}

                            {/* Step 5: Scraping Progress */}
                            {step === 5 && (
                                <div className="space-y-6">
                                    <h2 className="text-2xl font-semibold text-gray-800 mb-4 text-center">
                                        Scraping in Progress...
                                    </h2>

                                    <div className="flex justify-center mb-6">
                                        <i className="fas fa-spinner fa-spin text-6xl text-indigo-600"></i>
                                    </div>

                                    <div className="bg-gray-50 rounded-lg p-6">
                                        {/* Brand Progress */}
                                        {progress.currentBrand && (
                                            <div className="mb-4 pb-4 border-b">
                                                <div className="flex justify-between text-sm text-gray-600 mb-2">
                                                    <span className="font-semibold">Current Brand:</span>
                                                    <span className="text-indigo-600">{progress.currentBrand}</span>
                                                </div>
                                                <div className="flex justify-between text-sm text-gray-600">
                                                    <span>Brand Progress:</span>
                                                    <span>{progress.brandIndex} of {progress.totalBrands}</span>
                                                </div>
                                                {progress.gridPoint && (
                                                    <div className="flex justify-between text-sm text-gray-600 mt-1">
                                                        <span>Grid Point:</span>
                                                        <span>{progress.gridPoint}</span>
                                                    </div>
                                                )}
                                            </div>
                                        )}

                                        {/* Overall Progress */}
                                        <div className="mb-4">
                                            <div className="flex justify-between text-sm text-gray-600 mb-2">
                                                <span>{progress.message}</span>
                                                <span className="font-bold text-indigo-600">{progress.percentage || 0}%</span>
                                            </div>
                                            <div className="w-full bg-gray-200 rounded-full h-4">
                                                <div
                                                    className="bg-gradient-to-r from-indigo-500 to-indigo-600 h-4 rounded-full transition-all duration-300 flex items-center justify-center"
                                                    style={{ width: `${progress.percentage || 0}%` }}
                                                >
                                                    {progress.percentage > 10 && (
                                                        <span className="text-xs font-semibold text-white">
                                                            {progress.percentage}%
                                                        </span>
                                                    )}
                                                </div>
                                            </div>
                                            <p className="text-center text-xs text-gray-500 mt-2">
                                                {progress.current} / {progress.total} operations complete
                                            </p>
                                        </div>

                                        <div className="flex justify-between border-t pt-4">
                                            <span className="text-gray-600">Current Cost:</span>
                                            <span className="font-semibold text-indigo-600">â‚¹{actualCost.toFixed(2)}</span>
                                        </div>
                                    </div>

                                    <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                                        <p className="text-yellow-800 text-sm">
                                            <i className="fas fa-clock mr-2"></i>
                                            Please don't close this window. Scraping may take several minutes depending on the number of brands.
                                        </p>
                                    </div>
                                </div>
                            )}

                            {/* Step 6: Download Results */}
                            {step === 6 && (() => {
                                const cleanedResults = cleanResults(results);
                                const stats = getCleaningStats(results, cleanedResults);
                                
                                return (
                                    <div className="space-y-6">
                                        <div className="text-center">
                                            <i className="fas fa-check-circle text-6xl text-green-500 mb-4"></i>
                                            <h2 className="text-2xl font-semibold text-gray-800 mb-2">
                                                Scraping Complete!
                                            </h2>
                                            <p className="text-gray-600">
                                                Your results are ready to download
                                            </p>
                                        </div>

                                        {/* Raw Results Summary */}
                                        <div className="bg-gray-50 rounded-lg p-6 space-y-4">
                                            <h3 className="font-semibold text-gray-800 mb-3">ðŸ“Š Raw Results Summary</h3>
                                            <div className="flex justify-between border-b pb-3">
                                                <span className="text-gray-600">Total Locations Found:</span>
                                                <span className="font-semibold text-blue-600">{results.length}</span>
                                            </div>
                                            {results.length === 1000 && (
                                                <div className="bg-yellow-50 border border-yellow-200 rounded p-3">
                                                    <p className="text-sm text-yellow-800">
                                                        <i className="fas fa-info-circle mr-2"></i>
                                                        <strong>Note:</strong> Display limited to 1,000 rows. Your download will include ALL results from the session.
                                                    </p>
                                                </div>
                                            )}
                                            <div className="flex justify-between border-b pb-3">
                                                <span className="text-gray-600">City:</span>
                                                <span className="font-semibold">{selectedCity}</span>
                                            </div>
                                            <div className="flex justify-between border-b pb-3">
                                                <span className="text-gray-600">Brands Scraped:</span>
                                                <span className="font-semibold">{brands.length}</span>
                                            </div>
                                            <div className="flex justify-between">
                                                <span className="text-gray-600">Total Cost:</span>
                                                <span className="font-semibold text-indigo-600">â‚¹{actualCost.toFixed(2)}</span>
                                            </div>
                                        </div>

                                        {/* Cleaned Results Summary */}
                                        <div className="bg-green-50 border-2 border-green-200 rounded-lg p-6 space-y-4">
                                            <h3 className="font-semibold text-green-800 mb-3">âœ¨ Clean Results Summary</h3>
                                            <div className="flex justify-between border-b border-green-200 pb-3">
                                                <span className="text-green-700">Valid Locations:</span>
                                                <span className="font-semibold text-green-600 text-lg">{cleanedResults.length}</span>
                                            </div>
                                            <div className="flex justify-between border-b border-green-200 pb-3">
                                                <span className="text-green-700">Removed:</span>
                                                <span className="font-semibold text-red-600">{stats.removed}</span>
                                            </div>
                                            <div className="mt-4 pt-4 border-t border-green-200">
                                                <p className="text-sm text-green-700 font-semibold mb-2">Removed by reason:</p>
                                                <div className="grid grid-cols-2 gap-2 text-sm">
                                                    <div className="flex justify-between">
                                                        <span className="text-gray-600">Missing data:</span>
                                                        <span className="font-semibold">{stats.removedByReason.missingData}</span>
                                                    </div>
                                                    <div className="flex justify-between">
                                                        <span className="text-gray-600">Not operational:</span>
                                                        <span className="font-semibold">{stats.removedByReason.notOperational}</span>
                                                    </div>
                                                    <div className="flex justify-between">
                                                        <span className="text-gray-600">Brand mismatch:</span>
                                                        <span className="font-semibold">{stats.removedByReason.brandMismatch}</span>
                                                    </div>
                                                    <div className="flex justify-between">
                                                        <span className="text-gray-600">Invalid pattern:</span>
                                                        <span className="font-semibold">{stats.removedByReason.invalidPattern}</span>
                                                    </div>
                                                    <div className="flex justify-between col-span-2">
                                                        <span className="text-gray-600">Wrong category:</span>
                                                        <span className="font-semibold">{stats.removedByReason.wrongCategory}</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div className="bg-white rounded p-3 mt-4">
                                                <p className="text-sm text-gray-600">
                                                    <i className="fas fa-info-circle text-green-600 mr-2"></i>
                                                    <strong>Clean results include only:</strong> Operational locations with strict brand name matches, valid categories, and no invalid patterns.
                                                </p>
                                            </div>
                                        </div>

                                        {/* Download Options */}
                                        <div className="flex flex-col space-y-3">
                                            <button
                                                onClick={() => downloadResults(true)}
                                                className="w-full bg-green-600 text-white px-6 py-4 rounded-lg hover:bg-green-700 transition-colors text-lg font-semibold shadow-lg"
                                            >
                                                <i className="fas fa-sparkles mr-2"></i> Download Clean Results ({cleanedResults.length} locations)
                                            </button>
                                            <button
                                                onClick={() => downloadResults(false)}
                                                className="w-full bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors"
                                            >
                                                <i className="fas fa-database mr-2"></i> Download Raw Results ({results.length} locations)
                                            </button>
                                            <button
                                                onClick={resetApp}
                                                className="w-full bg-gray-200 text-gray-700 px-6 py-3 rounded-lg hover:bg-gray-300 transition-colors"
                                            >
                                                <i className="fas fa-redo mr-2"></i> Start New Scraping
                                            </button>
                                        </div>
                                    </div>
                                );
                            })()}
                        </div>

                        {/* Footer */}
                        <div className="text-center mt-6 text-gray-600 text-sm">
                            <p>Â© 2024 Retail Brands Scraper for Expansion | Powered by Google Maps API</p>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
